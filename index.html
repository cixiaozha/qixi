<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>流星许愿</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    height: 100%;
    background: radial-gradient(ellipse at bottom, #0b0c2b 0%, #050618 100%);
    font-family: "Arial", sans-serif;
  }
  canvas {
    position: absolute;
    top: 0;
    left: 0;
  }
  #starsContainer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }
  #signatureModal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 300px;
    padding: 20px;
    background: url('https://i.imgur.com/3r5G1Mf.png') no-repeat center/cover;
    color: white;
    text-align: center;
    border-radius: 15px;
    display: none;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
  }
  #storyBtn {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    padding: 15px 40px;
    background: rgba(255,255,255,0.2);
    backdrop-filter: blur(10px);
    border-radius: 25px;
    color: white;
    font-size: 18px;
    cursor: pointer;
    border: none;
    transition: 0.3s;
  }
  #storyBtn:hover {
    background: rgba(255,255,255,0.4);
  }
</style>
</head>
<body>

<canvas id="meteorCanvas"></canvas>
<canvas id="starCanvas"></canvas>

<div id="signatureModal"></div>
<button id="storyBtn">进入故事册</button>

<script>
const canvas = document.getElementById('meteorCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const starCanvas = document.getElementById('starCanvas');
const sctx = starCanvas.getContext('2d');
starCanvas.width = window.innerWidth;
starCanvas.height = window.innerHeight;

const stars = [];
const maxStars = 5;
let clickedStars = [];

const goodSigns = [
  "今天会遇到好事", "心情特别棒", "工作顺利", "有惊喜收获", "人际关系良好",
  "财运不错", "会被夸奖", "遇到有趣的人", "精神满满", "生活愉快"
];
const badSigns = [
  "小心交通", "注意感冒", "有小麻烦", "稍微疲惫", "别太焦虑"
];

function randomSign() {
  if(Math.random() < 0.2) {
    return badSigns[Math.floor(Math.random()*badSigns.length)];
  } else {
    return goodSigns[Math.floor(Math.random()*goodSigns.length)];
  }
}

function createMeteor() {
  return {
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height/2,
    length: Math.random()*80 + 20,
    speed: Math.random()*4 + 4,
    angle: Math.random()*Math.PI/4 + Math.PI/8
  }
}

const meteors = [];
for(let i=0;i<30;i++) meteors.push(createMeteor());

function drawMeteors() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let m of meteors){
    ctx.strokeStyle = 'rgba(255,255,255,0.7)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(m.x, m.y);
    ctx.lineTo(m.x - m.length*Math.cos(m.angle), m.y + m.length*Math.sin(m.angle));
    ctx.stroke();
    m.x += m.speed*Math.cos(m.angle);
    m.y -= m.speed*Math.sin(m.angle);
    if(m.x > canvas.width || m.y < 0){
      Object.assign(m, createMeteor());
    }
  }
  requestAnimationFrame(drawMeteors);
}
drawMeteors();

// 星星点亮
function drawStars(){
  sctx.clearRect(0,0,starCanvas.width, starCanvas.height);
  // 连线
  if(clickedStars.length>1){
    sctx.strokeStyle = 'rgba(255,255,255,0.5)';
    sctx.lineWidth = 1.5;
    sctx.beginPath();
    sctx.moveTo(clickedStars[0].x, clickedStars[0].y);
    for(let i=1;i<clickedStars.length;i++){
      sctx.lineTo(clickedStars[i].x, clickedStars[i].y);
    }
    sctx.stroke();
  }
  for(let star of clickedStars){
    sctx.fillStyle = 'yellow';
    sctx.beginPath();
    sctx.arc(star.x, star.y, 10, 0, Math.PI*2);
    sctx.fill();
  }
  requestAnimationFrame(drawStars);
}
drawStars();

starCanvas.addEventListener('click', (e)=>{
  if(clickedStars.length>=maxStars) return;
  const rect = starCanvas.getBoundingClientRect();
  clickedStars.push({x:e.clientX - rect.left, y:e.clientY - rect.top});
  if(clickedStars.length===maxStars){
    setTimeout(()=>{
      const modal = document.getElementById('signatureModal');
      modal.innerText = randomSign();
      modal.style.display = 'block';
    },300);
  }
});

document.getElementById('storyBtn').addEventListener('click', ()=>{
  window.location.href = 'story.html';
});

window.addEventListener('resize', ()=>{
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  starCanvas.width = window.innerWidth;
  starCanvas.height = window.innerHeight;
});
</script>

</body>
</html>
