<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>查看信件</title>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getFirestore, collection, query, where, getDocs, orderBy } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD-uySj9cGYhkwrJdotbAfsbm8tb0fFLxs",
    authDomain: "letter-7e55f.firebaseapp.com",
    projectId: "letter-7e55f",
    storageBucket: "letter-7e55f.firebasestorage.app",
    messagingSenderId: "548585980662",
    appId: "1:548585980662:web:04b91b01d509f54f9562d7",
    measurementId: "G-RQ90689GRT"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let recipientName = '';

  window.onload = async () => {
    recipientName = prompt("请输入你的昵称：") || "轩轩";
    await loadMessages();
  };

  async function loadMessages() {
    const container = document.getElementById("messages");
    container.innerHTML = "";
    const q = query(collection(db, "messages"), where("to", "==", recipientName));
    const snap = await getDocs(q);
    snap.forEach(doc => {
      const data = doc.data();
      const sentAt = data.timestamp ? data.timestamp.toDate().toLocaleString() : '';
      const div = document.createElement("div");
      div.style.borderBottom = "1px solid rgba(255,255,255,0.2)";
      div.style.padding = "10px 0";
      div.innerHTML = `<p>${data.text}</p><small>来自: ${data.from} | ${sentAt}</small>`;
      container.appendChild(div);
    });
  }
</script>
<style>
  body{font-family: Arial,sans-serif;background:#0b1220;color:#fff;padding:20px;}
  #messages{max-width:600px;margin:auto;}
</style>
</head>
<body>
<h2>你的信件</h2>
<div id="messages"></div>
</body>
</html>
