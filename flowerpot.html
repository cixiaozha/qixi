<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æˆ‘ä»¬çš„èŠ±ç›†å°ä¸–ç•Œ ğŸŒ±</title>
<style>
    body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #ffe6f0, #fff0f5); display: flex; flex-direction: column; align-items: center; padding: 20px; min-height: 100vh; }
    h1 { font-size: 2rem; color: #c44569; margin-bottom: 10px; }
    .flowerPot { width: 300px; height: 300px; border: 2px solid #c44569; display: grid; grid-template-columns: repeat(10, 1fr); grid-template-rows: repeat(10, 1fr); gap: 2px; margin-bottom: 20px; position: relative; }
    .pixel { width: 100%; height: 100%; background: #fff5f7; transition: background 0.3s; }
    .buttons { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
    button { padding: 10px 20px; border: none; border-radius: 8px; background: linear-gradient(135deg,#ff9ff3,#f368e0); color:#fff; font-weight:bold; cursor:pointer; transition: transform 0.2s; }
    button:hover { transform: translateY(-3px); }
    .titles { margin-bottom: 10px; font-size:1rem; color:#c44569; }
    .messages { width: 300px; max-height: 150px; overflow-y: auto; border:1px solid #f78fb3; padding:5px; margin-bottom:10px; background:#fff5f7; border-radius:5px; }
    .messageInput { display:flex; gap:5px; margin-bottom:20px; }
    .messageInput input { flex:1; padding:5px; border-radius:5px; border:1px solid #f78fb3; }
    .giftOverlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.7); display:flex; justify-content:center; align-items:center; color:#fff; font-size:2rem; z-index:999; display:none; flex-direction: column; }
</style>
</head>
<body>
<h1>æˆ‘ä»¬çš„èŠ±ç›†å°ä¸–ç•Œ ğŸŒ±</h1>
<div class="flowerPot" id="flowerPot"></div>
<div class="titles" id="titles"></div>
<div class="buttons">
    <button id="waterBtn">æµ‡æ°´ ğŸ’§</button>
    <button id="magicBtn">ç¥ç§˜åŠ›é‡ âœ¨</button>
</div>

<div class="messages" id="messages"></div>
<div class="messageInput">
    <input type="text" id="messageInput" placeholder="å†™ä¸‹ä»Šå¤©çš„ç•™è¨€...">
    <button id="sendMsgBtn">å‘é€</button>
</div>

<div class="giftOverlay" id="giftOverlay">
    <div>ğŸ‰ èŠ±ç›†æˆç†Ÿå•¦ï¼ğŸ‰</div>
    <div>ä½ è·å¾—äº†ä¸“å±å¤§ç¤¼ç‰© â¤ï¸</div>
    <button onclick="document.getElementById('giftOverlay').style.display='none'">å…³é—­</button>
</div>

<!-- Firebase å…¼å®¹ SDK -->
<script src="https://www.gstatic.com/firebasejs/10.20.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.20.0/firebase-database-compat.js"></script>

<script>
// ====== Firebase é…ç½® ======
const firebaseConfig = {
  apiKey: "AIzaSyDc27UjdsySJAz4-1NpY0Cgs3Jq3402o70",
  authDomain: "flowerpotapp-d0c7a.firebaseapp.com",
  databaseURL: "https://flowerpotapp-d0c7a-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "flowerpotapp-d0c7a",
  storageBucket: "flowerpotapp-d0c7a.appspot.com",
  messagingSenderId: "347864027088",
  appId: "1:347864027088:web:ee3a267fb4f546bb5ef3d5"
};

// åˆå§‹åŒ– Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const flowerPotRef = db.ref('flowerPot');

// ====== æ¸²æŸ“èŠ±ç›† ======
const flowerPotDiv = document.getElementById('flowerPot');
let blocks = [];
function renderFlowerPot(blocksArr) {
    flowerPotDiv.innerHTML = '';
    for (let i=0;i<100;i++){
        const div = document.createElement('div');
        div.className = 'pixel';
        if(blocksArr && blocksArr[i] && blocksArr[i].color){
            div.style.background = blocksArr[i].color;
        }
        flowerPotDiv.appendChild(div);
    }
}

// ====== æ˜¾ç¤ºç§°å· ======
const titlesDiv = document.getElementById('titles');
function updateTitles(titlesArr){
    titlesDiv.innerText = titlesArr ? 'ç§°å·ï¼š' + titlesArr.join(' | ') : '';
}

// ====== ç•™è¨€ ======
const messagesDiv = document.getElementById('messages');
function updateMessages(msgArr){
    messagesDiv.innerHTML = '';
    if(msgArr){
        msgArr.forEach(m=>{
            const p = document.createElement('div');
            p.innerText = m;
            messagesDiv.appendChild(p);
        });
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
}

// ====== é¡µé¢å®æ—¶ç›‘å¬ ======
flowerPotRef.on('value', snapshot=>{
    const data = snapshot.val() || {};
    blocks = data.blocks || [];
    renderFlowerPot(blocks);
    updateTitles(data.titles);
    updateMessages(data.messages);
    if(data.matured) document.getElementById('giftOverlay').style.display='flex';
});

// ====== æµ‡æ°´é€»è¾‘ ======
document.getElementById('waterBtn').addEventListener('click', ()=>{
    flowerPotRef.once('value').then(snapshot=>{
        const data = snapshot.val() || {};
        const now = Date.now();
        const lastWatered = data.lastWatered || 0;
        const today = new Date().toDateString();
        const lastDay = new Date(lastWatered).toDateString();
        if(today === lastDay){
            alert('ä»Šå¤©å·²ç»æµ‡è¿‡æ°´å•¦ ğŸŒ±');
            return;
        }
        const currentDay = (data.currentDay||0)+1;
        let titles = data.titles||[];
        if(currentDay % 20 === 0){
            const newTitle = ['æœ€ä½³æµ‡æ°´å‘˜ ğŸŒ¸','èŠ±ç›†å®ˆæŠ¤è€… ğŸŒ¿','å¹¸ç¦æ’­ç§å¸ˆ ğŸŒ¼','çˆ±å¿ƒå›­ä¸ ğŸ’–','èŠ±ç›†é­”æ³•å¸ˆ âœ¨','æµªæ¼«èŠ±å›­å®ˆæŠ¤è€… ğŸŒ¹'][(currentDay/20-1)%6];
            titles.push(newTitle);
            alert('ğŸ‰ èŠ±ç›†æˆé•¿å•¦ï¼ç§°å·ï¼š'+newTitle);
        }
        let blocksArr = data.blocks||Array(100).fill({color:'#fff5f7'});
        for(let i=0;i<5;i++){
            const idx = Math.floor(Math.random()*100);
            blocksArr[idx]={color:'#ff9f43'};
        }
        let matured = data.matured||false;
        if(currentDay >= 100) matured = true;
        flowerPotRef.update({
            currentDay: currentDay,
            lastWatered: now,
            blocks: blocksArr,
            titles: titles,
            lastAction: 'ä½ ä»Šå¤©æµ‡äº†æ°´ ğŸ’§',
            matured: matured
        });
    });
});

// ====== ç¥ç§˜åŠ›é‡æŒ‰é’® ======
document.getElementById('magicBtn').addEventListener('click', ()=>{
    flowerPotRef.once('value').then(snapshot=>{
        const data = snapshot.val() || {};
        let currentDay = (data.currentDay||0) + Math.floor(Math.random()*5)+1;
        let titles = data.titles||[];
        while(currentDay >= titles.length*20+20){
            const idx = titles.length%6;
            const newTitle = ['æœ€ä½³æµ‡æ°´å‘˜ ğŸŒ¸','èŠ±ç›†å®ˆæŠ¤è€… ğŸŒ¿','å¹¸ç¦æ’­ç§å¸ˆ ğŸŒ¼','çˆ±å¿ƒå›­ä¸ ğŸ’–','èŠ±ç›†é­”æ³•å¸ˆ âœ¨','æµªæ¼«èŠ±å›­å®ˆæŠ¤è€… ğŸŒ¹'][idx];
            titles.push(newTitle);
            alert('âœ¨ ç¥ç§˜åŠ›é‡è§¦å‘ï¼ç§°å·æå‰è·å¾—ï¼š'+newTitle);
        }
        let blocksArr = data.blocks||Array(100).fill({color:'#fff5f7'});
        for(let i=0;i<5;i++){
            const idx = Math.floor(Math.random()*100);
            blocksArr[idx]={color:'#ff9f43'};
        }
        let matured = data.matured||false;
        if(currentDay >= 100) matured = true;
        flowerPotRef.update({
            currentDay: currentDay,
            blocks: blocksArr,
            titles: titles,
            lastAction: 'ç¥ç§˜åŠ›é‡ ğŸ’«',
            matured: matured
        });
    });
});

// ====== ç•™è¨€ ======
document.getElementById('sendMsgBtn').addEventListener('click', ()=>{
    const input = document.getElementById('messageInput');
    const msg = input.value.trim();
    if(!msg) return;
    flowerPotRef.once('value').then(snapshot=>{
        const data = snapshot.val() || {};
        const messages = data.messages||[];
        messages.push(msg);
        flowerPotRef.update({messages:messages});
        input.value='';
    });
});
</script>
</body>
</html>
