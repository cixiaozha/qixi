<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æˆ‘ä»¬çš„èŠ±ç›†å°ä¸–ç•Œ ğŸŒ±</title>

<style>
body {
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(135deg,#ffe6f0,#fff0f5);
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:20px;
  min-height:100vh;
}

h1 { color:#c44569; margin-bottom:10px; }

.flowerPot {
  width:300px; height:300px;
  border:2px solid #c44569;
  display:grid;
  grid-template-columns:repeat(10,1fr);
  grid-template-rows:repeat(10,1fr);
  gap:2px;
  margin-bottom:15px;
}

.pixel { background:#fff5f7; }

.buttons {
  display:flex;
  gap:12px;
  margin-bottom:15px;
}

button {
  padding:10px 18px;
  border:none;
  border-radius:8px;
  background:linear-gradient(135deg,#ff9ff3,#f368e0);
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}

.titles {
  margin:10px 0;
  color:#c44569;
  font-weight:bold;
}

.calendar {
  width:320px;
  background:#fff;
  border-radius:10px;
  padding:10px;
  border:1px solid #f78fb3;
}

.day {
  margin-bottom:8px;
}

.day-title {
  font-weight:bold;
  color:#c44569;
  margin-bottom:4px;
}

.log {
  font-size:0.9rem;
  padding-left:10px;
}
</style>
</head>

<body>

<h1>æˆ‘ä»¬çš„èŠ±ç›†å°ä¸–ç•Œ ğŸŒ±</h1>

<div class="flowerPot" id="flowerPot"></div>

<div class="buttons">
  <button id="waterBtn">æµ‡æ°´ ğŸ’§</button>
  <button id="magicBtn">ç¥ç§˜åŠ›é‡ âœ¨</button>
</div>

<div class="titles">ğŸ“… æµ‡æ°´æ—¥å†ï¼ˆåªè¯»ï¼‰</div>
<div class="calendar" id="calendar"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.20.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.20.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDc27UjdsySJAz4-1NpY0Cgs3Jq3402o70",
  authDomain: "flowerpotapp-d0c7a.firebaseapp.com",
  databaseURL: "https://flowerpotapp-d0c7a-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "flowerpotapp-d0c7a",
  storageBucket: "flowerpotapp-d0c7a.appspot.com",
  messagingSenderId: "347864027088",
  appId: "1:347864027088:web:ee3a267fb4f546bb5ef3d5"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const ref = db.ref('flowerPot');

const flowerPotDiv = document.getElementById('flowerPot');
const calendarDiv = document.getElementById('calendar');

function renderPot(blocks){
  flowerPotDiv.innerHTML='';
  for(let i=0;i<100;i++){
    const d=document.createElement('div');
    d.className='pixel';
    if(blocks && blocks[i]) d.style.background=blocks[i].color;
    flowerPotDiv.appendChild(d);
  }
}

function renderCalendar(logs){
  calendarDiv.innerHTML='';
  if(!logs) return;

  Object.keys(logs).sort().forEach(date=>{
    const day=document.createElement('div');
    day.className='day';

    const title=document.createElement('div');
    title.className='day-title';
    title.innerText=date;

    day.appendChild(title);

    logs[date].forEach(l=>{
      const p=document.createElement('div');
      const icon=l.type==='water'?'ğŸ’§':'âœ¨';
      p.className='log';
      p.innerText=`${icon} ${l.time}${l.message?' ï½œ '+l.message:''}`;
      day.appendChild(p);
    });

    calendarDiv.appendChild(day);
  });
}

ref.on('value',snap=>{
  const data=snap.val()||{};
  renderPot(data.blocks);
  renderCalendar(data.logs);
});

// ===== æµ‡æ°´ =====
document.getElementById('waterBtn').onclick=()=>{
  ref.once('value').then(s=>{
    const d=s.val()||{};
    const today=new Date().toISOString().slice(0,10);
    const nowStr=new Date().toLocaleString();

    if(new Date(d.lastWatered||0).toDateString()===new Date().toDateString()){
      alert('ä»Šå¤©å·²ç»æµ‡è¿‡æ°´å•¦ ğŸŒ±');
      return;
    }

    const logs=d.logs||{};
    if(!logs[today]) logs[today]=[];
    logs[today].push({type:'water',time:nowStr,message:''});

    ref.update({
      lastWatered:Date.now(),
      currentDay:(d.currentDay||0)+1,
      logs
    });

    alert('ğŸ’§ æµ‡æ°´æˆåŠŸï¼');
  });
};

// ===== ç¥ç§˜åŠ›é‡ =====
document.getElementById('magicBtn').onclick=()=>{
  ref.once('value').then(s=>{
    const d=s.val()||{};
    const today=new Date().toISOString().slice(0,10);
    const nowStr=new Date().toLocaleString();

    const logs=d.logs||{};
    if(!logs[today]) logs[today]=[];
    logs[today].push({type:'magic',time:nowStr,message:''});

    ref.update({ logs });
    alert('âœ¨ ç¥ç§˜åŠ›é‡è§¦å‘ï¼');
  });
};
</script>

</body>
</html>
