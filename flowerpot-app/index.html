<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>å°ç›†æ ½æˆé•¿è®°å½•</title>

<style>
body{
  font-family:sans-serif;
  background:#f5f6fb;
  text-align:center;
}

/* æœˆä»½ç½‘æ ¼ */
#months{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
  max-width:420px;
  margin:10px auto;
}

.month{
  background:#e0e0e0;
  padding:12px;
  border-radius:10px;
  cursor:pointer;
}
.month:hover{opacity:0.8;}

/* æ—¥æœŸç½‘æ ¼ */
#calendar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:6px;
  max-width:420px;
  margin:10px auto;
}

.day{
  padding:10px 0;
  border-radius:8px;
  cursor:pointer;
  font-size:14px;
}

.gray{background:#d6d6d6;}
.watered{background:#000;color:#fff;}
.event{background:gold;color:#000;}
.today{border:2px solid red;}

/* è¯¦æƒ…å¡ */
.day-detail{
  margin:16px auto;
  max-width:420px;
  background:#fff0f5;
  border-radius:12px;
  padding:12px;
  text-align:left;
}

/* ç¥ç§˜å¼¹çª— */
#popup{
  position:fixed;
  top:0;left:0;right:0;bottom:0;
  background:rgba(0,0,0,0.4);
  display:none;
  align-items:center;
  justify-content:center;
}

#popupBox{
  background:white;
  padding:20px;
  border-radius:12px;
}
</style>
</head>

<body>

<h2>ğŸŒ± å°ç›†æ ½æˆé•¿è®°å½•</h2>

<div id="months"></div>
<div id="calendar"></div>

<div class="day-detail">
  <h3>ğŸ“œ å½“å¤©è®°å½•</h3>
  <div id="detailContent">ç‚¹å‡»æŸä¸€å¤©æŸ¥çœ‹ ğŸŒ±</div>
</div>

<div id="popup">
  <div id="popupBox"></div>
</div>

<script>
const startDate = new Date("2026-01-28");
const monthsDiv = document.getElementById("months");
const calendar = document.getElementById("calendar");
const detail = document.getElementById("detailContent");
const popup = document.getElementById("popup");
const popupBox = document.getElementById("popupBox");

let DATA = null;

/* è¯»å– JSON */
async function load(){
  try{
    const res = await fetch("pot.json");
    DATA = await res.json();
  }catch(e){
    DATA = {messages:{}, specialEvents:{}};
  }
  renderMonths();
  checkTodayEvent();
}

/* æ¸²æŸ“æœˆä»½ */
function renderMonths(){
  monthsDiv.innerHTML="";
  calendar.innerHTML="";

  for(let m=1;m<=12;m++){
    const div=document.createElement("div");
    div.className="month";
    div.textContent=`2026å¹´ ${m}æœˆ`;
    div.onclick=()=>renderMonthDays(2026,m);
    monthsDiv.appendChild(div);
  }
}

/* æ¸²æŸ“æŸä¸ªæœˆçš„æ—¥æœŸ */
function renderMonthDays(year,month){
  calendar.innerHTML="";

  const watered = new Set(Object.keys(DATA.messages||{}));
  const events = new Set(Object.keys(DATA.specialEvents||{}));
  const todayStr = new Date().toISOString().split("T")[0];

  const lastDay = new Date(year,month,0).getDate();

  for(let d=1; d<=lastDay; d++){
    const date = new Date(year,month-1,d);
    if(date < startDate) continue;

    const dateStr = date.toISOString().split("T")[0];

    const div=document.createElement("div");
    div.className="day gray";
    div.textContent=d;

    if(watered.has(dateStr)) div.className="day watered";
    if(events.has(dateStr)) div.className="day event";
    if(dateStr===todayStr) div.classList.add("today");

    div.onclick=()=>showDetail(dateStr);

    calendar.appendChild(div);
  }
}

/* ç‚¹å‡»æ—¥æœŸæ˜¾ç¤ºè¯¦æƒ…ï¼ˆä¸å¼¹çª—ï¼‰ */
function showDetail(dateStr){
  const msgs = DATA.messages?.[dateStr] || [];
  const evs = DATA.specialEvents?.[dateStr] || [];

  let html=`<div><b>ğŸ“… ${dateStr}</b></div>`;

  if(!msgs.length && !evs.length){
    html+=`<div style="opacity:0.6">è¿™ä¸€å¤©æ²¡æœ‰è®°å½• ğŸŒ±</div>`;
  }

  msgs.forEach(m=> html+=`<div>ğŸ’¬ ${m}</div>`);
  evs.forEach(e=> html+=`<div style="color:#8e44ad">âœ¨ ${e}</div>`);

  detail.innerHTML=html;
}

/* ä»Šæ—¥ç¥ç§˜äº‹ä»¶å¼¹çª— */
function checkTodayEvent(){
  const today = new Date().toISOString().split("T")[0];
  if(DATA.specialEvents?.[today]?.length){
    showPopup(`âœ¨ ç¥ç§˜åŠ›é‡ï¼š${DATA.specialEvents[today].slice(-1)[0]}`);
  }
}

function showPopup(text){
  popupBox.innerHTML = text + "<br><br><button onclick='popup.style.display=\"none\"'>çŸ¥é“äº†</button>";
  popup.style.display="flex";
}

load();
</script>

</body>
</html>
